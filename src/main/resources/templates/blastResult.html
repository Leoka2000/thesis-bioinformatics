<!DOCTYPE html>
<html class="theme-dark" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>BLAST Results</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css" />
    <script>
        function sortTable(columnIndex, isNumeric) {
            const table = document.getElementById("blastResultsTable");
            const tbody = table.getElementsByTagName("tbody")[0];
            const rows = Array.from(tbody.getElementsByTagName("tr"));
            
            let sortOrder = table.getAttribute("data-sort-order") === "asc" ? "desc" : "asc";
            table.setAttribute("data-sort-order", sortOrder);
            
            rows.sort((rowA, rowB) => {
                let cellA = rowA.getElementsByTagName("td")[columnIndex].innerText.trim();
                let cellB = rowB.getElementsByTagName("td")[columnIndex].innerText.trim();
                
                if (isNumeric) {
                    return sortOrder === "asc" ? cellA - cellB : cellB - cellA;
                } else {
                    return sortOrder === "asc" ? cellA.localeCompare(cellB) : cellB.localeCompare(cellA);
                }
            });
            
            rows.forEach(row => tbody.appendChild(row)); // Reappend sorted rows
        }
    </script>
</head>
<body>
    <div th:replace="fragments/navbar :: body"></div>
    <section class="section">
        <div class="container">
            <a href="/blast" style="margin-bottom: 0.75rem;" class="button is-dark is-primary">Back</a>
            <h1 class="title">BLAST Results</h1>
            <div th:if="${error}" class="notification is-danger">
                <p th:text="${error}"></p>
            </div>
            <div th:unless="${error}">
                <div class="box">
                    <h2 class="subtitle">BLAST Output Information</h2>
                    <div class="content">
                        <p><strong>Program:</strong> <span th:text="${blastOutputInfo.program}"></span></p>
                        <p><strong>Version:</strong> <span th:text="${blastOutputInfo.version}"></span></p>
                        <p><strong>Reference:</strong> <span th:text="${blastOutputInfo.reference}"></span></p>
                        <p><strong>Database:</strong> <span th:text="${blastOutputInfo.db}"></span></p>
                        <p><strong>Query ID:</strong> <span th:text="${blastOutputInfo.queryId}"></span></p>
                        <p><strong>Query Definition:</strong> <span th:text="${blastOutputInfo.queryDef}"></span></p>
                        <p><strong>Query Length:</strong> <span th:text="${blastOutputInfo.queryLen}"></span></p>
                    </div>
                </div>

                <table id="blastResultsTable"  class="table is-bordered is-striped is-hoverable is-fullwidth" data-sort-order="asc">
                    <thead>
                        <tr>
                            <th onclick="sortTable(0, true)">Hit Number</th>
                            <th onclick="sortTable(1, false)">Hit ID</th>
                            <th onclick="sortTable(2, false)">Definition</th>
                            <th style="cursor: pointer;" onclick="sortTable(3, false)">Accession<span style="font-size: 0.75rem; margin-inline-start: 0.25rem;" class="arrow">▼</span></th>
                            <th style="cursor: pointer;" onclick="sortTable(4, true)">Length<span style="font-size: 0.75rem; margin-inline-start: 0.25rem;" class="arrow">▼</span></th>
                            <th style="cursor: pointer;" onclick="sortTable(5, true)">Bit Score<span style="font-size: 0.75rem; margin-inline-start: 0.25rem;" class="arrow">▼</span></th>
                            <th style="cursor: pointer;" onclick="sortTable(6, true)">E-value<span style="font-size: 0.75rem; margin-inline-start: 0.25rem;" class="arrow">▼</span></th>
                            <th style="cursor: pointer;" onclick="sortTable(7, true)">Identity<span style="font-size: 0.75rem; margin-inline-start: 0.25rem;" class="arrow">▼</span></th>
                            <th style="cursor: pointer;" onclick="sortTable(8, true)">Positive<span style="font-size: 0.75rem; margin-inline-start: 0.25rem;" class="arrow">▼</span></th>
                            <th style="cursor: pointer;" onclick="sortTable(9, true)">Gaps<span style="font-size: 0.75rem; margin-inline-start: 0.25rem;" class="arrow">▼</span></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="hit : ${hits}">
                            <td th:text="${hit.num}"></td>
                            <td th:text="${hit.id}"></td>
                            <td th:text="${hit.def}"></td>
                            <td th:text="${hit.accession}"></td>
                            <td th:text="${hit.len}"></td>
                            <td th:text="${hit.bitScore}"></td>
                            <td th:text="${hit.evalue}"></td>
                            <td th:text="${hit.identity}"></td>
                            <td th:text="${hit.positive}"></td>
                            <td th:text="${hit.gaps}"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>
</body>
</html>
